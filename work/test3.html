<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <style>
        canvas {
            border:1px solid #000;
        }
        textarea {
            width:300px;
            height: 200px;
        }
        main {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
        }
    </style>
</head>
<body>
    <main>
    <section>
   <img src="sheet.png" id="sheet">
   <input type="range" id="camx">
   <input type="range" id="camy"><br>
   <canvas id="screen" width="640" height="480"></canvas>
    </section> 
   <section>
    <div>lev 0</div> 
    <textarea wrap="off" id="s0_0_0"></textarea>
    <textarea wrap="off" id="s0_1_0"></textarea>
    <br>
    <textarea wrap="off" id="s0_0_1"></textarea>
    <textarea wrap="off" id="s0_1_1"></textarea>
    </section>
    <section>
    lev 1<br> 
    <textarea wrap="off" id="s1_0_0"></textarea>
    <textarea wrap="off" id="s1_1_0"></textarea>
    <br>
    <textarea wrap="off" id="s1_0_1"></textarea>
    <textarea wrap="off" id="s1_1_1"></textarea>
    </section>
</main>
    <button>RENDER</button>
    <button>INC X</button>
    <button>DEC X</button>
    <button>INC Y</button>
    <button>DEC Y</button>
    <button>INC X 10</button>
    <button>DEC X 10</button>
    <button>INC Y 10</button>
    <button>DEC Y 10</button>

    <script>
        const ctx = document.querySelector("canvas").getContext("2d");
        const src = document.querySelector("img");
        let camx = 0;
        let camy = 0;
        document.querySelectorAll('button').forEach(item => {item.addEventListener('click', render)});    
        
        function render(ev){
            const azioni = {'RENDER':[0,0],'INC X':[1,0],'DEC X':[-1,0],'INC Y':[0,1],'DEC Y':[0,-1],
            'INC X 10':[10,0],'DEC X 10':[-10,0],'INC Y 10':[0,10],'DEC Y 10':[0,-10]
        };
            const az = ev.target.textContent;
            camx+=azioni[az][0];
            camy+=azioni[az][1];
            ctx.clearRect(0, 0, 640, 480);
            const parallax = [0.1,1.0];
            const ssx = [80,80];
            const ssy = [50,50];
            const ids = ["s0_0_0","s0_1_0","s0_0_1","s0_1_1","s1_0_0","s1_1_0","s1_0_1","s1_1_1"];
            const sectors = new Map();
            for (let s of ids) sectors.set(s,document.getElementById(s).value.split("\n"));

            //ctx.drawImage(src,0,0);

            for (let layer=0;layer<2;layer++){
                for (let x=0;x<21;x++){
                    for (let y=0;y<16;y++){
                        const dx = camx%32;
                        const dy = camy%32;
                        const atx = Math.floor(camx/32)+x;
                        const aty = Math.floor(camy/32)+y;
                        const sx = Math.floor(atx/ssx[layer]);
                        const sy = Math.floor(aty/ssy[layer]);
                        const tx = atx%ssx[layer];
                        const ty = aty%ssy[layer];
                        let n = sectors.get("s"+layer+"_"+sx+"_"+sy)[ty].charCodeAt(tx);
                        //let n = 18+17;
                        plot(x,y,dx,dy,n);

                    }
                }


            }



        }

        function plot(x,y,dx,dy,n){
            const col = n%17;
            const row = Math.floor(n/17);
            const sx = col*16;
            const sy = row*16;
            ctx.drawImage(src, sx, sy, 16, 16, x*32-dx, y*32-dy, 32, 32);  
        }


        document.querySelector("#s0_0_0").value=
`abcdef##########################################################################
ABCDEF##########################################################################
################################################################################
################################################################################
################################################################################
################################################################################
################################################################################
#ABC############################################################################
################################################################################
################################################################################
################################################################################
qrs#############################################################################
################################################################################
################################################################################
###qes##########################################################################
################################################################################
################################################################################
################################################################################
##twz###########################################################################
################################################################################
################################################################################
################################################################################
################################################################################
################################################################################
################################################################################
###tttttttt#####################################################################
################################################################################
################################################################################
################################################################################
################################################################################
################################################################################
################################################################################
####wwwwwww#####################################################################
################################################################################
################################################################################
################################################################################
################################################################################
################################################################################
################################################################################
###zzzzzzz#####################3################################################
################################################################################
################################################################################
################################################################################
################################################################################
##########333333333333##########################################################
################################################################################
################################################################################
################################################################################
################################################################################
aaaaaaa#########################################################################`;
document.querySelector("#s1_0_0").value=
`################################################################################
################################################################################
########!!!#####################################################################
################################################################################
################################################################################
################################################################################
################################################################################
################################################################################
################################################################################
################################################################################
################################################################################
################################################################################
################################################################################
################################################################################
################################################################################
################################################################################
################################################################################
################################################################################
################################################################################
################################################################################
################################################################################
################################################################################
################################################################################
################################################################################
################################################################################
################################################################################
################################################################################
################################################################################
################################################################################
################################################################################
################################################################################
################################################################################
################################################################################
################################################################################
################################################################################
################################################################################
################################################################################
################################################################################
################################################################################
################################################################################
################################################################################
################################################################################
################################################################################
################################################################################
################################################################################
################################################################################
################################################################################
################################################################################
################################################################################
################################################################################`;
    </script>
</body>
</html>